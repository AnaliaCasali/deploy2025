import{c as k,l as g}from"./chunk-5KY6YBJG.js";import{q as f}from"./chunk-4DCJT2OD.js";import{I as l,M as u,R as n,k as i,sa as h,v as a}from"./chunk-X5N6KVFF.js";var d={production:!0,apiUrl:"https://ies63lastoscas.edu.ar/",userId:""};var w=(()=>{let r=class r{constructor(t,o,e){this.httpClient=t,this.router=o,this.platformId=e,this.apiURL=d.apiUrl+"auth",this.tokenKey="authToken"}login(t,o){return this.httpClient.post(this.apiURL+"/login",{username:t,password:o}).pipe(l(e=>{e.token&&this.setToken(e.token)}),a(e=>e.status===401?i(()=>new Error("Sin Autorizacion")):i(()=>e)))}register(t){return console.log("Datos del objeto u:",JSON.stringify(t,null,2)),this.httpClient.post(this.apiURL+"/register",t).pipe(l(e=>{e.token&&this.setToken(e.token)}),a(e=>i(()=>e)))}setToken(t){localStorage.setItem(this.tokenKey,t),this.setPayloadData()}getToken(){return f(this.platformId)?localStorage.getItem(this.tokenKey):""}isAuthenticated(){return this.getToken()?this.tokenExpiro()?!0:(this.removerToken(),!1):(i(()=>new Error("Sin Autorizacion")),!1)}removerToken(){localStorage.removeItem(this.tokenKey),localStorage.removeItem("dni"),localStorage.removeItem("rol"),localStorage.removeItem("username")}logout(){this.removerToken(),this.router.navigate(["login"])}setPayloadData(){let t=this.getToken();if(t){let o=JSON.parse(atob(t.split(".")[1])),e=o.exp*1e4*60*1,c=o.rol,p=o.sub,m=o.dni;localStorage.setItem("rol",c),localStorage.setItem("dni",m),localStorage.setItem("username",p),console.log("payload:"+o),console.log("rol:"+c),console.log("dni:"+m),console.log("sub:"+p)}}setIntervalVerifyAndRemoveToken(){setInterval(()=>{this.VerificarTokenExpiradoyRemover()},2*60*60*1e3)}tokenExpiro(){let t=this.getToken();if(!t)return i(()=>new Error("Sin Autorizacion")),!1;let e=JSON.parse(atob(t.split(".")[1])).exp*1e4*60*60*2;return Date.now()<e}VerificarTokenExpiradoyRemover(){this.tokenExpiro()&&this.removerToken()}getRole(){return localStorage.getItem("rol")}};r.\u0275fac=function(o){return new(o||r)(n(k),n(g),n(h))},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{d as a,w as b};

import{a as v}from"./chunk-CB6FNCUI.js";import{a as p,b as $}from"./chunk-5AS2EY2S.js";import{a as b,c as S,l as E}from"./chunk-5KY6YBJG.js";import{q as c}from"./chunk-4DCJT2OD.js";import{I as h,M as I,R as l,g as u,k as f,sa as g,v as o}from"./chunk-X5N6KVFF.js";var k=(()=>{let a=class a{constructor(t,e,r,s,i){this.http=t,this.authService=e,this.router=r,this.platformId=s,this.notificacionService=i,this.apiUrlInsc=p.apiUrl+"api/inscripcionmesasexamen",this.apiUrlItems=p.apiUrl+"api/itemsinscripcionmesas",this.apiUrl=p.apiUrl+"api/mesas-examen",this.inscriptosSource=new u({inscriptos:[],carrera:null,materia:null}),this.currentInscriptos=this.inscriptosSource.asObservable(),this.listaInscriptosSource=new u({inscriptos:[],anio:null,llamado:null,carrera:null,materia:null}),this.currentListaInscriptos=this.listaInscriptosSource.asObservable()}ObtenerListaInscriptos(){let t=`${this.apiUrlInsc}/lista-inscriptos`,e=this.getHeaders();return this.http.get(t,{headers:e}).pipe(o(this.handleError))}ObtenerDatos(){let t="";c(this.platformId)&&(t=localStorage.getItem("dni")||"");let e=`${this.apiUrl}/disponibles/${t}`,r=this.getHeaders();return this.http.get(e,{headers:r}).pipe(o(this.handleError))}getHeaders(){let t=new b;if(c(this.platformId))if(this.authService.isAuthenticated()){let e=localStorage.getItem("authToken");e?t=t.set("Authorization",`Bearer ${e}`):console.warn("No se encontr\xF3 el token en localStorage")}else console.warn("Usuario no autenticado");else console.warn("No se puede acceder a localStorage en este entorno");return t}saveInscripcion(t,e){let r="";c(this.platformId)&&(r=localStorage.getItem("dni")||"");let s={dniUsuario:r,mesasExamenIds:t,estado:e},i=this.getHeaders();return this.http.post(`${this.apiUrlInsc}/guardar`,s,{headers:i}).pipe(h(()=>{r?this.notificacionService.crearNotificacion("Inscripci\xF3n registrada",r).subscribe(()=>console.log("Notificaci\xF3n creada correctamente"),n=>console.error("Error al crear la notificaci\xF3n",n)):console.error("DNI no est\xE1 definido")}),o(this.handleError))}updateEstado(t,e){let r=this.getHeaders(),s={aceptados:t.map(i=>i.idInsc),rechazados:e.map(i=>i.idInsc)};return this.http.post(`${this.apiUrlItems}/cambiarEstado`,s,{headers:r}).pipe(h(()=>{t.forEach(i=>{let n=`Has sido aceptado en ${i.materia} para el ${i.turnoLlamado} llamado`;this.notificacionService.crearNotificacion(n,i.dni).subscribe(()=>console.log(`Notificaci\xF3n enviada al alumno con DNI ${i.dni}`),m=>console.error("Error al enviar notificaci\xF3n",m))}),e.forEach(i=>{let n=`Has sido rechazado en ${i.materia} para el ${i.turnoLlamado} llamado`;this.notificacionService.crearNotificacion(n,i.dni).subscribe(()=>console.log(`Notificaci\xF3n enviada al alumno con DNI ${i.dni}`),m=>console.error("Error al enviar notificaci\xF3n",m))})}),o(this.handleError))}updateNota(t){let e=this.getHeaders(),r=t.map(s=>({id:s.idInsc,nota:s.nota}));return this.http.post(`${this.apiUrlItems}/asignarNota`,r,{headers:e}).pipe(h(()=>{t.forEach(s=>{let i=`Se ha registrado una nota de ${s.nota} en ${s.materia}, llamado: ${s.llamado}`;this.notificacionService.crearNotificacion(i,s.dni).subscribe(()=>console.log(`Notificaci\xF3n enviada al alumno con DNI ${s.dni}`),n=>console.error("Error al enviar notificaci\xF3n",n))})}),o(this.handleError))}ObtenerNotas(){let t="";if(c(this.platformId)&&(t=localStorage.getItem("dni")||""),!t)return console.error("DNI no est\xE1 definido. No se puede obtener la lista de inscriptos."),f("DNI no est\xE1 definido");let e=`${this.apiUrlItems}/notasMesasExamen/${t}`,r=this.getHeaders();return this.http.get(e,{headers:r}).pipe(o(this.handleError))}ObtenerListaInscriptosAceptados(){let t=this.getHeaders();return this.http.get(`${this.apiUrlInsc}/lista-inscriptos-aceptados`,{headers:t}).pipe(o(this.handleError))}updateInscriptos(t){this.inscriptosSource.next(t)}updateListaInscriptos(t){this.listaInscriptosSource.next(t)}handleError(t){return console.error("A ocurrido un error",t),f(t.message||"Server Error")}ObtenerDatosMesasProf(){let t="";c(this.platformId)&&(t=localStorage.getItem("dni")||"");let e=`${this.apiUrl}/mesasxtribunal/${t}`,r=this.getHeaders();return this.http.get(e,{headers:r}).pipe(o(this.handleError))}ObtenerMesasInscritasPorDni(){let t="";c(this.platformId)&&(t=localStorage.getItem("dni")||"");let e=`${this.apiUrlInsc}/mismesasalumno/${t}`,r=this.getHeaders();return this.http.get(e,{headers:r}).pipe(o(this.handleError))}};a.\u0275fac=function(e){return new(e||a)(l(S),l($),l(E),l(g),l(v))},a.\u0275prov=I({token:a,factory:a.\u0275fac,providedIn:"root"});let d=a;return d})();export{k as a};
